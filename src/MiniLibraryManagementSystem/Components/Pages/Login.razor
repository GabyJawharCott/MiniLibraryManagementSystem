@page "/"
@page "/login"
@rendermode InteractiveServer
@attribute [AllowAnonymous]
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthState

<PageTitle>Welcome â€” Mini Library Management System</PageTitle>

<div class="container mt-5" style="max-width: 420px;">
    <div class="text-center mb-4">
        <h1 class="mb-2">Mini Library Management System</h1>
        <p class="text-muted">Sign in to continue</p>
    </div>
    @if (Message is { Length: > 0 })
    {
        <div class="alert alert-warning">@Message</div>
    }
    <div class="d-flex flex-column gap-2">
        <a href="Account/ExternalLogin?provider=Google&returnUrl=@Uri.EscapeDataString(ReturnUrl ?? "")" class="btn btn-outline-danger btn-lg">Sign in with Google</a>
        <a href="Account/ExternalLogin?provider=Microsoft&returnUrl=@Uri.EscapeDataString(ReturnUrl ?? "")" class="btn btn-outline-primary btn-lg">Sign in with Microsoft</a>
    </div>
</div>

@code {
    [SupplyParameterFromQuery]
    public string? Message { get; set; }

    [SupplyParameterFromQuery(Name = "returnUrl")]
    public string? ReturnUrl { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var state = await AuthState.GetAuthenticationStateAsync();
        if (state.User.Identity?.IsAuthenticated == true)
            Navigation.NavigateTo(ReturnUrl ?? "/dashboard", forceLoad: true);
    }
}
